# Задача:

Необходимо реализовать REST-приложение для работы с экскурсиями. Пользователи
должны иметь возможность регистрироваться, ставить лайки и оставлять комментарии к экскурсиям,
записываться и отменять экскурсии.

# Сущности:

Пользователь (поля: имя, эл. почта, номер телефона, дата регистрации,
пароль, роль)

Экскурсия (поля: название, дата проведения, описание)

Лайк (поля: пользователь, экскурсия)

Комментарий (поля: текст комментария, время комментирования, пользователь, экскурсия)

# Отношения между сущностями:

Один ко Многим: Пользователь - Комментарий, Пользователь - Лайк, Экскурсия - Лайк, Экскурсия - Комментарий

Многие ко Многим: Пользователь - Экскурсия

# Необходимый функционал:

1. CRUD для всех сущностей
2. Разделение пользователей на администраторов и обычных пользователей
3. Возможность авторизации и аутентификации
4. Шифрование пароля пользователя
5. Создание нового пользователя не имея учетной записи
6. Поля новых сущностей должны валидироваться с помощью @Valid и Spring Validator
7. Администратор должен иметь возможность просматривать записи на экскурсии, удалять/добавлять лайки, комментарии,
   пользователей, менять их роль
8. Один уникальный пользователь может оставить лайк один раз для одной экскурсии
9. Уникальный пользователь может оставлять любое количество комментариев к экскурсии
10. При удалении пользователя или экскурсии текст комментария не должен удаляться
11. При удалении пользователя или экскурсии связанные лайки должны удаляться
12. Администратор должен иметь расширенную информацию о других объектах
13. Пользователь должен иметь возможность просматривать все свои связанные сущности
14. В зависимости от требований зависимые сущности должны возвращаться в сортированных и пагинироуемых списках
15. Сортировка и пагинация должны работать одновременно
16. Пользователь должен иметь возмоность поставить лайки и прокомментировать экскурсию
17. Администратор должен иметь право добавить/удалить человека из экскурсии
18. В возвращаемых JSON'ах не должно быть лишней информации
19. Пользователь должен иметь возможность просматривать не только все свои экскурсии (включая прошедшие), но и только
    те, которые должны состояться
20. Пользователь должен иметь возможность видеть чужие лайки и комментарии к экскурсиям
21. Пользователь должен иметь возможность получить количество лайков к определенной экскурсии
22. Пользователь должен иметь возможность получить оповещение о количестве дней до его ближайшей экскурсии
23. Пользователь должен иметь возможность поиска экскурсий по совпадению первых букв названия
24. Пользователь должен иметь возможность поиска других пользователей по совпадению первых букв имени
25. Пользователь должен иметь возможность получить по id информацию о любых лайках, комментариях, экскурсиях,
    пользователях
26. Права администратора должны расширять, а не заменять права пользователя
27. Администратор должен иметь возможность получить всю информацию о всех пользователях в одном списке
28. Администратор должен иметь возможность по id пользователя получить всю информацию о его связанных сущностях
29. При изменении пользователя администратором все связанные сущности пользователя должны остаться прежними
30. Администратор должен иметь возможность получить список записанных на экскурсию пользователей по ее id
31. Администратор должен иметь возможность обнулить лайки экскурсии
32. Администатор должен иметь возможность исключать/ добавлять из экскурсии пользователей
33. Администратор должен иметь возможность одним запросос полностью очистить список пользователей, записанных на
    экскурсию
34. Администратор должен иметь возможность один раз в определенный период выявлять лучшую экскурсию по количеству лайков
    с их обнулением. Если период времени еще не прошел, то администратор не может выявить победителя
35. Администратор не должен иметь возможность ставить лайки и оставлять комментарии за других пользователей, но у него
    есть возможность их удалять
36. Функции обычного пользователя и администратора не должны дублироваться, каждая функция должна быть уникальной
37. Приложение должно иметь возможность работать на PostgreSQL
38. Приложение должно иметь возможность работать на H2 (по умолчанию), быстрой проверки работы приложения без
    дополнительных настроек
39. При перезапуске приложения все таблицы должны быть перепопулированы для удобства тестирования
40. Для удобства тестирования использовать Swagger Open API
41. Настроить аутентификацию и авторизацию прямо в Swagger Open API
42. Создать кастомную аннотацию для подсчета вермени, необходимого для выполнения метода, с выведением в консоль

### Стэк: Spring Boot, Spring Data JPA, Spring Security, Spring JdbcTemplate, Hibernate, Spring Validator, PostgreSQL, H2, Git, Maven

# Документация

С документацией можно ознакомиться, запустив приложение com.sovetnikov.application.ExcursionAppApplication и перейдя по
ссылке [ссылке](http://localhost:8080/swagger-ui/index.html). Или ниже в этом файле.
То, что может сделать обычный пользователь доступно и администратору, но не наоборот. При недостатке прав ответ 403.
Более подробно о доступных функциях в их описании.

## Функции пользователя

### User-Excursion

#### GET /api/user/excursion/{id}/like

Доступна всем пользователям. Возвращает список лайков экскурсии по ее id с именем пользователя и названием экскурсии.
Ответ 200, если экскурсия существует, иначе 404

#### POST /api/user/excursion/{id}/like

Доступна всем пользователям. Создает лайк для экскурсии по ее id. Все лайки уникальны, один пользователь может поставить
лайк для одной экскурсии только один раз. Ответ 200, если экскурсия существует, иначе 404. Повторная попытка поставить
лайк вернет 400

#### GET /api/user/excursion/{id}/comment

Доступна всем пользователям. Возвращает список комментариев экскурсии по ее id с именем пользователя и временем
комментирования. Список отсртирован по времени. Ответ 200, если id существует, иначе 404

#### POST /api/user/excursion/{id}/comment

Доступна всем пользователям. Создает комментарий к экскурсии по ее id от имени данного пользователя. Сообщение не должно
превышать 300 знаков. Ответ 200, если id существует, иначе 404

#### GET /api/user/excursion

Доступна всем пользователям. Возвращает список экскурсий с названием, датой проведения и описанием. Есть разделение на
страницы по 3 экскурсии, отсчет с 0. При false возращает все экскурсии, сортированные по дате от самой дальней.При true
возрващает только будущие экскурсии, начиная с самой ближайшей. Ответ 200

#### GET /api/user/excursion/{id}

Доступна всем пользователям. Возвращает название экскурсии, дату проведения, цену и количество лайков по id экскурсии.
Ответ 200, если id существует, иначе 404

#### GET /api/user/excursion/own

Доступна всем пользователям. Возвращает список экскурсий данного пользователя, на которые он записан. При false вернутся
все экскурсии пользователя, включая прошедшие. Список отсортирован по дате проведения.При true вернутся только будущие
экскурсии пользователя. Список отсортирован от самой ближайшей до самой дальней.

#### GET /api/user/excursion/own/attention

Доступна всем пользователям. Возвращает ближайшую по дате экскурсию, на которую записан данный пользователь.
Возвращается название, дата экскурсии и количество дней до экскурсии.Ответ 200

#### GET /api/user/excursion/findByName

Доступна всем пользователям. Ищет экскурсии по совпадающим первым буквам и возвращает список с названием, описанием и
датой проведения. Список отсортирован по алфавиту. Ответ 200

### User-Profile

#### DELETE /api/user

Доступна всем зарегистрированным пользователям. Удаляет только текущего пользователя.Ответ 200, иначе 404.

#### PATCH /api/user

Доступна всем зарегистрированным пользователям. Полностью изменяет личные данные текущего пользователя. Все лайки,
комментарии, экскурсии остаются привязанными к этому пользователю. Ограничения, такие же как и при создании
пользователя.Ответ 200, иначе 404. При ошибке - 400

#### GET /api/user/{id}

Доступна всем зарегистрированным пользователям. Возвращает контактные данные пользователя по id. Ответ 200, если id
существует, иначе 404.

#### GET /api/user/findByName

Доступна всем зарегистрированным пользователям. Возвращает список пользователей по совпадению первых букв. В запросе
игнорируется регистр. Так же возвращаются контактные данные пользователей.Список сортирован по алфавиту.

### User-Like

#### GET /api/user/like/own

Доступна всем зарегестрированным пользователям. Возвращает все лайки (имя пользователя, название экскурсии)
авторизованного пользователя. Ответ 200, если пользователь существует, иначе 404.

#### DELETE /api/user/like/{id}

Доступна всем зарегистрированным пользователям. Удаляет лайк по id. Если лайк принадлежит другому пользователю, то ответ
400, если id не существует - 404. При удачной попытке - 200

### User-Comment

#### GET /api/user/comment/own

Доступна всем пользователям. Возвращает все комментарии данного пользователя с именем, нащванием экскурсии, сообщением и
временем кмментирования.Все комментарии отсортированы по времени.Ответ 200

#### DELETE /api/user/comment/{id}

Доступна всем пользователям. Удаляет комментарий данного пользователя по id комментария. Если комментарий не принадлежит
пользователю - ответ 400.Ответ 200, если такой комментарий существует, иначе 404

## Функции администратора

### Admin-Profile

#### GET /api/admin/user

Доступна только администратору. Возвращает список всех пользователей в алфавитном порядке по 3 пользователя на странице.
Нумерация страниц с 0. Пользователи возвращаются с информацией о имени, эл. почте и номере телефона

#### POST /api/admin/user

Доступна только для администратора. Создает нового пользователя. Администратор должен назначить роль. При введении
невалидных значений возвращает 400, иначе 200. Ограничения. Пароль не может быть null, дополнительно шифруется перед
сохранением в БД. Имя не может быть пустым и должно состоять от 2 до 100 знаков. Электронная почта должна быть
корректной (игнорируется регистр), уникальной, не превышать 100 знаков и не должна быть пустой. Номер телефона должен
состоять из 10 цифр, быть уникальным и не пустым.

#### GET /api/admin/user/{id}

Доступна только администратору. Возвращает контактные данные пользователя по id, экскурсии, на которые он записан (
название, дата выезда), его комментарии (сообщение, имя, экскурсия, дата и время комментирования), его лайки (имя,
экскурсия). При false возвращает все экскурсии, где записан пользотватель, включая прошедшие. При true возвращает только
будущие экскурсии. Экскурсии сортированы от ближайшей к более дальной. Ответ 200, если пользователь найден, иначе 404.

#### DELETE /api/admin/user/{id}

Доступна только администратору. Удаляет пользователя по id. Все его записи на экскурсии отменяются. Лайки удаляются.
Комментарии остаются без пользователя. Ответ 200, если такой id существует, иначе 404

#### PATCH /api/admin/user/{id}

Доступна только администратору. Полностью изменяет личные данные пользователя по id. Все лайки, комментарии, экскурсии
остаются привязанными к этому пользователю. Ограничения, такие же как и при создании пользователя.Ответ 200, если такой
id есть, иначе 404. При ошибке - 400

### Admin-Excursion

#### POST /api/admin/user/excursion

Доступна только администратору. Создает новую экскурсию. Ограничения. Название всегда должно начинаться с заглавной
буквы.Название должно состоять от 2 до 100 символов.Описание - не превышать более 500 символов, может быть пустым.Цена
не должна быть отрицательнной. Дата должна соответствовать формату. Ответ 200, при ошибке - 400.

#### GET /api/admin/user/excursion/{id}

Доступна только администратору. Возвращает по id название экскурсии, дату ее проведения, количество лайков и список всех
пользователей (в алфавитном порядке), которые на нее записаны с контактными даннымми. Ответ 200, если id существует,
иначе 404

#### DELETE /api/admin/user/excursion/{id}

Доступна только администратору. Удаляет экскурсию по id.Все ее лайки удаляются, список записанных на нее пользователей
очищается, комментарии к этой экскурсии остаются, но в названии эскурсии будет null.Ответ 200, если id существует, иначе
404

#### PATCH /api/admin/user/excursion/{id}

Доступна только администратору. Полностью изменяет данные эккскурсии по id. Ограничения, такие же как и при создании
экскурсии. Ответ 200, если id существует, иначе 404. При ошибке - 400

#### PATCH /api/admin/user/excursion/{id}/zeroing

Доступна только администратору. Обнуляет лайки экскурсии по ее id. Ответ 200, если экскурсия существует, иначе 404

#### PATCH /api/admin/user/excursion/{id}/exclusion

Доступна только администратору. Исключает из экскурсии (id) пользователя (userId). Если пользователь существует и
состоит в существующей экскурсии - ответ 200, иначе 404

#### PATCH /api/admin/user/excursion/{id}/clear

Доступна только администратору. Полностью очищает список пользователей, записанных на экскурсию по ее id. Ответ 200,
если id существует, иначе 404

#### PATCH /api/admin/user/excursion/{id}/add

Доступна только администратору. Записывает пользователя (userId) на экскурсию (id), если пользователь и экскурсия
существуют. Дублирование пользователей пресекается - ответ 400. Ответ 200, если id не существуют, то - 404

#### GET /api/admin/user/excursion/getWinner

Доступна только для администратора. Возвращает список прошедших экскурсий с их названием и датой проведения. Список
отсортирован по количеству лайков от большего к меньшему. После выявления победителя лайки обнуляются для для прошедших
экскурсий. На данный момент определять победителя можно каждый день. Период голосования можно изменить в
com.sovetnikov.application.CompetitionTimer. Если период соревнования еще не истек, то ответ 204.При удачном запросе -
200

### Admin-Like

#### GET /api/admin/user/{id}/like

Доступна только администратору. Возвращает все лайки пользователя (имя пользователя, название экскурсии) или пустой
список. Ответ 200, если id существует, иначе 404

#### DELETE /api/admin/user/like/{id}

Доступна только администратору. Удаялет любой лайк.Ответ 200, если лайк существует, иначе 404

### Admin-Comment

#### GET /api/admin/user/{id}/comment

Доступна только администратору. Возвращает все комментарии пользователя по его id с сообщением, именем, названием
экскурсии и временем комментирования.Все комментарии сортированы по времени.Ответ 200, если пользователь существует,
иначе 404

#### GET /api/admin/user/comment/{id}

Доступна только администратору.Возвращает комментарий по его id с сообщением, названием экскурсии, именем пользователя и
временем комментирования.Ответ 200, если комментарий существует, иначе 404

#### DELETE /api/admin/user/comment/{id}

Доступна только администратору. Удаляет комментарий по его id. Ответ 200, если комментарий существует, иначе 404

## Анонимный пользователь

### Registration

#### POST /api/login

Создает нового пользователя без авторизации c правами пользователя. Едиственная доступная функция для анонимных
пользователей. После авторизации недоступна. При введении невалидных значений возвращает 400, иначе 200. Ограничения.
Пароль не может быть null, дополнительно шифруется перед сохранением в БД. Имя не может быть пустым и должно состоять от
2 до 100 знаков. Электронная почта должна быть корректной (игнорируется регистр), уникальной, не превышать 100 знаков и
не должна быть пустой. Номер телефона должен состоять из 10 цифр, быть уникальным и не пустым.